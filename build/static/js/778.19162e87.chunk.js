"use strict";(self.webpackChunkhuts4u=self.webpackChunkhuts4u||[]).push([[778],{87778:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var i=n(89379),o=n(65043),r=n(7353),a=n(81637),l=n(94496),s=n(68903),d=n(11906),c=n(12110),u=n(26494),g=n(39336),h=n(76641),x=n(67784),v=n(59662),p=n(70579);const m=(0,v.A)((0,p.jsx)("path",{d:"m18 22-.01-6L14 12l3.99-4.01L18 2H6v6l4 4-4 3.99V22zM8 7.5V4h8v3.5l-4 4z"}),"HourglassBottom");var f=n(33580),A=n(61968),b=n(82533),k=n(69995),y=n(57488),w=n(73216);const C=()=>{const[e,t]=(0,o.useState)([]),[n,v]=(0,o.useState)([]),[C,j]=(0,o.useState)(!1),[I,S]=(0,o.useState)(!1),[T,R]=(0,o.useState)({}),[N,D]=(0,o.useState)(""),[L,P]=(0,o.useState)("all"),[W,z]=(0,o.useState)(""),[F,O]=(0,o.useState)(""),[B,E]=(0,o.useState)({}),[H,M]=(0,o.useState)({}),Y=(0,w.Zp)(),G=e=>{if(!e&&0!==e)return"\u20b90.00";let t=Number(e);return!isNaN(t)&&Math.abs(t)>1e3&&(t/=100),isNaN(t)?String(e):t.toLocaleString("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2})},Q=(0,o.useCallback)(async()=>{S(!0);try{var e,t;const n={data:{filter:""},page:0,pageSize:1e3,order:[["createdAt","DESC"]]},i=await(0,k.Vy)(n),o=(null===i||void 0===i||null===(e=i.data)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.rows)||[];v(o)}catch(n){console.error("Failed to fetch hotels",n)}finally{S(!1)}},[]),V=(0,o.useCallback)(e=>{if(!n.length||!e)return null;const t=e.toLowerCase().trim();let i=n.find(e=>{var n,i,o;return(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())===t||(null===(i=e.title)||void 0===i?void 0:i.toLowerCase())===t||(null===(o=e.propertyName)||void 0===o?void 0:o.toLowerCase())===t});return i||(i=n.find(e=>{var n,i,o;return(null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(t))||(null===(i=e.title)||void 0===i?void 0:i.toLowerCase().includes(t))||(null===(o=e.propertyName)||void 0===o?void 0:o.toLowerCase().includes(t))})),i||null},[n]),X=e=>{try{if(!e)return null;if(e.checkInDateTime){const t=new Date(e.checkInDateTime);if(!isNaN(t.getTime()))return t}if(e.checkInDate){const t=String(e.checkInDate).replace(/[\u2018\u2019\u201C\u201D]/g,"'").trim(),n=e.checkInTime?String(e.checkInTime).trim():"",i=["".concat(t," ").concat(n),"".concat(t,"T").concat(n),t];for(const e of i){if(!e)continue;const t=new Date(e);if(!isNaN(t.getTime()))return t}const o="".concat(t.replace(/'|'|'/g,"")," ").concat(n).replace(/[\u2018\u2019\u201C\u201D]/g,""),r=new Date(o);if(!isNaN(r.getTime()))return r}return null}catch(t){return null}},U=e=>{const t=X(e);if(!t)return!1;const n=new Date,i=t.getTime()-n.getTime(),o=String((null===e||void 0===e?void 0:e.bookingType)||(null===e||void 0===e?void 0:e.type)||"").toLowerCase();return"hourly"===o||"hour"===o?i>9e5:i>864e5},q=(0,o.useCallback)(async e=>{try{var n;R(t=>(0,i.A)((0,i.A)({},t),{},{[e]:!0}));const r=await(0,k.PR)(e);if(null!==r&&void 0!==r&&null!==(n=r.data)&&void 0!==n&&n.data){var o;const n=null===(o=r.data)||void 0===o?void 0:o.data;E(t=>(0,i.A)((0,i.A)({},t),{},{[e]:{rating:n.rating||0,reviewText:n.comment||"",ratingId:n.id}})),t(t=>t.map(t=>t.id===e?(0,i.A)((0,i.A)({},t),{},{rating:n.rating,reviewText:n.comment,hasRated:!0}):t))}}catch(r){console.error("Failed to fetch rating for booking ".concat(e,":"),r)}finally{R(t=>(0,i.A)((0,i.A)({},t),{},{[e]:!1}))}},[]);(0,o.useEffect)(()=>{Q()},[Q]),(0,o.useEffect)(()=>{(async()=>{j(!0);try{var e,o;const s={data:{filter:"",userId:(0,b.F6)()},page:0,pageSize:50,order:[["createdAt","DESC"]]},d=await(0,k.Gc)(s),c=(null===d||void 0===d||null===(e=d.data)||void 0===e||null===(o=e.data)||void 0===o?void 0:o.rows)||[];let u=c;n.length>0&&(u=c.map(e=>{const t=e.hotelName||e.propertyName||e.title,n=V(t);return(0,i.A)((0,i.A)({},e),n?{hotelId:n.id,hotelName:n.name||n.title||n.propertyName,hotelData:n}:{})})),t(u);const g={};for(const e of u){var r,a,l;const t=String(e.id),n=!e.status||"checkedin"!==String(e.status).toLowerCase().replace(/\s/g,"")||null!=e.rating&&0!==e.rating?Number(null!==(r=e.rating)&&void 0!==r?r:0):1;g[t]={rating:n,reviewText:null!==(a=null!==(l=e.reviewText)&&void 0!==l?l:e.comment)&&void 0!==a?a:"",ratingId:e.ratingId};const i=String(e.status||"").toLowerCase().replace(/\s/g,"");"checkedin"!==i&&"checkedout"!==i||q(t)}E(g)}catch(s){console.error("Failed to load bookings",s),y.oR.error("Failed to load bookings")}finally{j(!1)}})()},[q,V,n.length]),(0,o.useEffect)(()=>{e&&e.length&&E(t=>{const n=(0,i.A)({},t);return e.forEach(e=>{const t=String(e.id);if(!n[t]){var i,o,r;const a=!e.status||"checkedin"!==String(e.status).toLowerCase().replace(/\s/g,"")||null!=e.rating&&0!==e.rating?Number(null!==(i=e.rating)&&void 0!==i?i:0):1;n[t]={rating:a,reviewText:null!==(o=null!==(r=e.reviewText)&&void 0!==r?r:e.comment)&&void 0!==o?o:"",ratingId:e.ratingId}}}),n})},[e]);const J=async e=>{const n=e.amountPaid/100,o=(e=>{const t=e/1.2156862745,n=.05*t,i=.13*t,o=.18*i,r=.02*(t+n+i+o),a=.18*r;return{basePrice:Math.round(t),gstOnBase:n,commission:i,gstOnCommission:o,convenienceFee:r,gstOnConvenience:a,totalCheck:t+n+i+o+r+a}})(n),r=o.convenienceFee+o.gstOnConvenience,a=(Math.ceil(r),n-r),l=Math.floor(a);if(!U(e))return void y.oR.info("hourly"===(null===e||void 0===e?void 0:e.bookingType)||"hour"===(null===e||void 0===e?void 0:e.bookingType)?"Hourly bookings can only be cancelled more than 15 minutes before start.":"Bookings can only be cancelled more than 24 hours before check-in.");const s=e.status;t(t=>t.map(t=>t.id===e.id?(0,i.A)((0,i.A)({},t),{},{status:"cancelled"}):t));try{const t={paymentId:e.paymentId,amount:l};await(0,k.WD)(t);const n={userId:(0,b.F6)(),hotelId:e.hotelId,bookingId:e.id,amount:e.amountPaid,refundAmount:l,reason:"Guest requested cancellation",status:"pending",processedBy:1,refundedAt:(new Date).toISOString(),currency:"INR"};await(0,k.ik)(e.id,{status:"Cancel"});try{var d,c,u;const t={data:{filter:"",bookingId:e.id},page:0,pageSize:50},n=await(0,k.E5)(t),i=null===n||void 0===n||null===(d=n.data)||void 0===d||null===(c=d.data)||void 0===c||null===(u=c.rows)||void 0===u?void 0:u[0];null!==i&&void 0!==i&&i.id&&await(0,k.k)(i.id,{status:"cancelled"})}catch(v){console.error("Error updating hotel revenue:",v)}try{var g,h,x;const t={data:{filter:"",bookingId:e.id},page:0,pageSize:50},n=await(0,k.Al)(t),i=null===n||void 0===n||null===(g=n.data)||void 0===g||null===(h=g.data)||void 0===h||null===(x=h.rows)||void 0===x?void 0:x[0];null!==i&&void 0!==i&&i.id&&await(0,k.QJ)(i.id,{status:"cancelled"})}catch(v){console.error("Error updating my revenue:",v)}await(0,k.xd)(n),y.oR.success("Booking cancelled and you will receive the payment in between 7-14 days.")}catch(p){t(t=>t.map(t=>t.id===e.id?(0,i.A)((0,i.A)({},t),{},{status:s}):t)),y.oR.error("Failed to cancel booking. Please try again.")}},Z=(0,o.useMemo)(()=>{const t=e=>String(e||"").toLowerCase().replace(/\s/g,"");let n=e.filter(e=>{const n=t(e.status);if("all"!==L){if("pending"===L&&"pending"!==n)return!1;if("checkedIn"===L&&"checkedin"!==n)return!1;if("checkedOut"===L&&"checkedout"!==n)return!1;if("cancelled"===L&&!n.startsWith("cancel"))return!1}if(N.trim()){if(!((e.hotelName||e.propertyName||e.title||"")+" "+(e.guestName||"")).toLowerCase().includes(N.toLowerCase().trim()))return!1}const i=X(e);if(i){if(W){const e=new Date(W);if(e.setHours(0,0,0,0),i<e)return!1}if(F){const e=new Date(F);if(e.setHours(23,59,59,999),i>e)return!1}}return!0});const i={pending:0,checkedin:1,checkedout:2,cancelled:3};return n.sort((e,n)=>{var o,r,a,l,s,d;const c=null!==(o=i[t(e.status)])&&void 0!==o?o:99,u=null!==(r=i[t(n.status)])&&void 0!==r?r:99;if(c!==u)return c-u;const g=null!==(a=null===(l=X(e))||void 0===l?void 0:l.getTime())&&void 0!==a?a:0;return(null!==(s=null===(d=X(n))||void 0===d?void 0:d.getTime())&&void 0!==s?s:0)-g}),n},[e,N,L,W,F]);if(C||I)return(0,p.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:(0,p.jsx)(a.A,{})});const K=e.filter(e=>"pending"===String(e.status).toLowerCase().replace(/\s/g,"")).length,$=e=>{const t=String(e||"").toLowerCase().replace(/\s/g,"");return"checkedin"===t?"#1976d2":"checkedout"===t?"green":"pending"===t?"#faaf00":t.startsWith("cancel")?"#d32f2f":"#666"};return(0,p.jsxs)(r.A,{sx:{background:f.A.thirdColor,px:{xs:2,md:4},py:4,minHeight:"100vh"},children:[(0,p.jsx)(l.A,{variant:"h4",fontWeight:"bold",sx:{textAlign:"center",color:f.A.firstColor,mb:2},children:"Your Bookings"}),K>0&&(0,p.jsxs)(l.A,{sx:{textAlign:"center",mb:2,fontSize:14,color:"#555"},children:["You have ",(0,p.jsx)("strong",{children:K})," upcoming booking",K>1?"s":""," (shown on top)."]}),(0,p.jsx)(r.A,{sx:{mb:3,p:2,borderRadius:2,background:"#fff",boxShadow:"0 4px 20px rgba(0,0,0,0.08)"},children:(0,p.jsxs)(s.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,p.jsx)(s.Ay,{item:!0,xs:12,md:4,children:(0,p.jsx)(A.XY,{fullWidth:!0,label:"Search by hotel / property / guest",value:N,onChange:e=>D(e.target.value)})}),(0,p.jsx)(s.Ay,{item:!0,xs:12,md:4,children:(0,p.jsxs)(r.A,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,p.jsx)(d.A,{size:"small",variant:"all"===L?"contained":"outlined",sx:{textTransform:"none",borderRadius:"20px",minWidth:0},onClick:()=>P("all"),children:"All"}),(0,p.jsx)(d.A,{size:"small",variant:"pending"===L?"contained":"outlined",sx:{textTransform:"none",borderRadius:"20px",minWidth:0},onClick:()=>P("pending"),children:"Pending"}),(0,p.jsx)(d.A,{size:"small",variant:"checkedIn"===L?"contained":"outlined",sx:{textTransform:"none",borderRadius:"20px",minWidth:0},onClick:()=>P("checkedIn"),children:"Checked In"}),(0,p.jsx)(d.A,{size:"small",variant:"checkedOut"===L?"contained":"outlined",sx:{textTransform:"none",borderRadius:"20px",minWidth:0},onClick:()=>P("checkedOut"),children:"Checked Out"}),(0,p.jsx)(d.A,{size:"small",variant:"cancelled"===L?"contained":"outlined",sx:{textTransform:"none",borderRadius:"20px",minWidth:0},onClick:()=>P("cancelled"),children:"Cancelled"})]})}),(0,p.jsx)(s.Ay,{item:!0,xs:12,md:4,children:(0,p.jsxs)(r.A,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,p.jsx)(A.XY,{label:"From date",type:"date",InputLabelProps:{shrink:!0},value:W,onChange:e=>z(e.target.value),sx:{flex:1}}),(0,p.jsx)(A.XY,{label:"To date",type:"date",InputLabelProps:{shrink:!0},value:F,onChange:e=>O(e.target.value),sx:{flex:1}})]})})]})}),(0,p.jsxs)(s.Ay,{container:!0,spacing:2,children:[0===Z.length&&(0,p.jsx)(s.Ay,{item:!0,xs:12,children:(0,p.jsx)(r.A,{sx:{textAlign:"center",py:6},children:(0,p.jsx)(l.A,{sx:{color:"#666"},children:"No bookings found for this filter."})})}),Z.map((n,o)=>{var v,A,w,C,j;const I=U(n),S=I?"Cancel booking":"hourly"===String((null===n||void 0===n?void 0:n.bookingType)||"").toLowerCase()||"hour"===String((null===n||void 0===n?void 0:n.bookingType)||"").toLowerCase()?"Hourly bookings can be cancelled only more than 15 minutes before start":"Bookings can be cancelled only more than 24 hours before check-in",R=String(n.id),N=null!==(v=B[R])&&void 0!==v?v:{rating:0,reviewText:""},D=Boolean(H[R]),L=Boolean(T[R]),P=String(n.status||"").toLowerCase().replace(/\s/g,"");return(0,p.jsx)(s.Ay,{item:!0,xs:12,md:6,children:(0,p.jsx)(c.A,{sx:{margin:"auto",mt:2,p:{xs:2,md:3},boxShadow:"0px 8px 28px rgba(0,0,0,0.12)",borderRadius:"12px",border:"1px solid ".concat(f.A.firstColor),position:"relative",cursor:"pointer"},onClick:e=>{e.target.closest('button, a, [role="button"]')||Y("/booking/".concat(n.id),{state:n})},children:(0,p.jsxs)(u.A,{sx:{p:0},children:[(0,p.jsx)(r.A,{sx:{position:"absolute",top:{xs:8,md:8},right:{xs:16,md:16},background:$(n.status),color:"white",px:1,borderRadius:{xs:"6px",md:"8px"},py:.5,display:"flex",alignItems:"center",gap:1,fontSize:"12px",textTransform:"capitalize"},children:n.status}),(0,p.jsx)(l.A,{variant:"h6",sx:{fontWeight:700,mb:.5,cursor:"pointer",color:f.A.firstColor,"&:hover":{textDecoration:"underline",opacity:.8}},onClick:e=>{var t;(e.stopPropagation(),n.hotelData||n.hotelId)?Y("/hotel/".concat(n.hotelId||(null===(t=n.hotelData)||void 0===t?void 0:t.id)),{state:{hotelData:n.hotelData||{id:n.hotelId,name:n.hotelName||n.propertyName||n.title}}}):y.oR.info("Hotel details not available")},children:(null===n||void 0===n?void 0:n.hotelName)||(null===n||void 0===n?void 0:n.propertyName)||(null===n||void 0===n?void 0:n.title)}),(0,p.jsxs)(l.A,{color:"textSecondary",sx:{fontSize:13},children:[null===n||void 0===n?void 0:n.checkInDate," ",null!==n&&void 0!==n&&n.checkInTime?", ".concat(n.checkInTime):""," ",null!==n&&void 0!==n&&n.guestName?"\xb7 ".concat(n.guestName):""]}),(0,p.jsxs)(l.A,{sx:{mt:1},children:[null!==(w=null===n||void 0===n?void 0:n.adults)&&void 0!==w?w:1," Adults",null!==n&&void 0!==n&&n.children?", ".concat(n.children," Child"):""]}),(0,p.jsx)(l.A,{variant:"h6",sx:{mt:1},children:G(null!==(C=null!==(j=null===n||void 0===n?void 0:n.amountPaid)&&void 0!==j?j:null===n||void 0===n?void 0:n.amount)&&void 0!==C?C:0)}),(0,p.jsx)(g.A,{sx:{my:1.5,borderStyle:"dashed",borderColor:"grey"}}),("checkedout"===P||"checkedin"===P)&&(0,p.jsx)(r.A,{display:"flex",flexDirection:"column",gap:2,mt:1,children:L?(0,p.jsx)(r.A,{display:"flex",justifyContent:"center",py:2,children:(0,p.jsx)(a.A,{size:24})}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(r.A,{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap",children:[(0,p.jsx)(l.A,{sx:{minWidth:90},children:"checkedin"===P?"Quick rating:":"Your rating:"}),(0,p.jsx)(h.A,{value:N.rating,onChange:(e,t)=>((e,t)=>{E(n=>(0,i.A)((0,i.A)({},n),{},{[e]:(0,i.A)((0,i.A)({},n[e]||{rating:0,reviewText:""}),{},{rating:Number(t||0)})}))})(R,t),disabled:D})]}),(0,p.jsx)(x.A,{label:"checkedin"===P?"Quick note":"Write your review",multiline:!0,minRows:"checkedin"===P?2:3,fullWidth:!0,value:N.reviewText,onChange:e=>{return t=R,n=e.target.value,void E(e=>(0,i.A)((0,i.A)({},e),{},{[t]:(0,i.A)((0,i.A)({},e[t]||{rating:0,reviewText:""}),{},{reviewText:n})}));var t,n},variant:"outlined",disabled:D,sx:{"& .MuiOutlinedInput-root":{borderRadius:"12px"}}}),(0,p.jsxs)(r.A,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:2,children:[(0,p.jsx)(d.A,{sx:{borderRadius:44,textTransform:"none"},variant:"outlined",onClick:e=>{e.stopPropagation(),Y("/booking/".concat(n.id),{state:n})},children:"Details"}),(0,p.jsxs)(r.A,{display:"flex",gap:2,children:[(0,p.jsx)(d.A,{sx:{background:"transparent",border:"solid 2px",color:f.A.firstColor,borderColor:f.A.firstColor,borderRadius:"44px",textTransform:"none"},onClick:e=>{e.stopPropagation(),((e,t)=>{E(n=>{var o,r;return(0,i.A)((0,i.A)({},n),{},{[e]:{rating:null!==(o=t.rating)&&void 0!==o?o:0,reviewText:null!==(r=t.reviewText)&&void 0!==r?r:"",ratingId:t.ratingId}})})})(R,n)},disabled:D,children:"Reset"}),(0,p.jsx)(d.A,{onClick:o=>{o.stopPropagation(),(async n=>{const o=String(n),r=B[o];if(!r)return void y.oR.info("Please provide a rating or review before submitting.");if(!r.rating||r.rating<=0)return void y.oR.info("Please select a rating before submitting.");const a=[...e];M(e=>(0,i.A)((0,i.A)({},e),{},{[o]:!0}));try{var l;const n=e.find(e=>String(e.id)===o),a={userId:(0,b.F6)(),hotelId:null===n||void 0===n?void 0:n.hotelId,bookingId:o,rating:Number(r.rating),comment:r.reviewText||""};let s;if(r.ratingId?(s=await(0,k.Am)(r.ratingId,a),y.oR.success("Rating updated successfully!")):(s=await(0,k.GS)(a),y.oR.success("Thanks for your review!")),null!==(l=s)&&void 0!==l&&l.data){const e=s.data;t(t=>t.map(t=>{var n,a;return String(t.id)===o?(0,i.A)((0,i.A)({},t),{},{rating:null!==(n=e.rating)&&void 0!==n?n:r.rating,reviewText:null!==(a=e.comment)&&void 0!==a?a:r.reviewText,hasRated:!0,ratingId:e.id}):t})),e.id&&!r.ratingId&&E(t=>(0,i.A)((0,i.A)({},t),{},{[o]:(0,i.A)((0,i.A)({},t[o]),{},{ratingId:e.id})}))}}catch(s){console.error("Failed to submit rating:",s),t(a),y.oR.error((null===s||void 0===s?void 0:s.message)||"Failed to submit review. Please try again.")}finally{M(e=>(0,i.A)((0,i.A)({},e),{},{[o]:!1}))}})(n.id)},variant:"contained",sx:{background:f.A.firstColor,color:"white",textTransform:"none",borderRadius:"44px",px:3},disabled:D,children:D?(0,p.jsx)(a.A,{size:20,color:"inherit"}):n.hasRated||N.ratingId?"Update Review":"Submit Review"})]})]})]})}),"pending"===P&&(0,p.jsxs)(r.A,{display:"flex",alignItems:"flex-start",mt:2,color:"#faaf00",children:[(0,p.jsx)(m,{}),(0,p.jsxs)(r.A,{sx:{ml:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[(0,p.jsx)(l.A,{children:"Upcoming"}),(0,p.jsx)(d.A,{sx:{background:"transparent",border:"solid 2px",color:f.A.firstColor,borderColor:f.A.firstColor,borderRadius:"44px",textTransform:"none",ml:2},onClick:e=>{e.stopPropagation(),J(n)},disabled:!I,title:S,children:"Cancel"}),(0,p.jsx)(d.A,{sx:{ml:1,borderRadius:44,textTransform:"none",border:"1px solid ".concat(f.A.firstColor)},variant:"outlined",onClick:e=>{e.stopPropagation(),Y("/booking/".concat(n.id),{state:n})},children:"Details"})]})]}),"pending"!==P&&!P.startsWith("cancel")&&"checkedin"!==P&&"checkedout"!==P&&(0,p.jsx)(r.A,{display:"flex",justifyContent:"flex-end",mt:2,children:(0,p.jsx)(d.A,{sx:{borderRadius:44,textTransform:"none"},variant:"outlined",onClick:e=>{e.stopPropagation(),Y("/booking/".concat(n.id),{state:n})},children:"Details"})})]})})},null!==(A=n.id)&&void 0!==A?A:o)})]})]})}}}]);
//# sourceMappingURL=778.19162e87.chunk.js.map